# Network

## 패킷 처리

- send시에 무조건 한 번에 하나씩 send되지 않을 수도 있음
  - n-send처럼 여러 send 요청을 중첩하여 보내는 경우

- recv시에는 보통 한 번에 하나의 send를 받으나 한 꺼번에 여러개의 send를 받을 수도 있음
  - 버퍼 크기의 제한 때문에 한 번에 받을 패킷을 여러개로 쪼개어 받을 수도 있음

- 때문에 이렇게 임의로 합쳐지거나 쪼개지는 패킷들을 파싱하여 제대로 된 패킷 단위로 만들어서 처리해야 함
  - 서로 프로토콜을 정의하여 `헤더 + 패킷바디`가 하나의 패킷 단위가 되게끔 설정
  - `헤더`에 `패킷바디`의 크기 정보를 포함시켜 `패킷바디` 크기만큼의 데이터를 받지 못하면
    데이터를 더 받기 위해 저장시켜놓았다가 다음 패킷을 더 받아 온전한 `패킷바디`를 만들어 처리
  - `헤더`에 포함된 `패킷바디`크기 보다 훨씬 큰 데이터를 받을 경우 하나의 `패킷`을 처리하고
    뒤에 추가로 붙은 데이터는 다시 `헤더` 분석부터 시작
  - 심지어는 이 `헤더` 조차도 쪼개어 질 경우도 있기 때문에 적절한 조취가 필요함

- 이런 패킷처리를 라이브러리에서 처리해 줄지, 애플리케이션에서 처리할 지는 서버의 목적, 용도 등에 따라 정해짐
- 보통 게임 서버의 경우 적은 양의 패킷을 주고받으며 통신하고, 각 패킷마다 엄청나게 신뢰성있는 데이터로 취급하지는 않기 때문에
  애플리케이션 레벨에서 필요할 경우에만 처리를 해주는 편
  - 로그인같이 많은 양의 데이터가 전송되어야 하는 (send가 많은) 경우에는 위의 상황을 고려하여 처리해 줘야함
- 또한, 클라이언트에서는 보통의 경우 하나의 서버와 통신하기 때문에 버퍼 크기도 매우 크게하여 데이터가 쪼개져 받아지는 일도 거의 없음

***
