# 대량의 데이터 입력

- 레디스 서버로 입력하는 데이터가 대량인 경우 여러가지 방법 존재
  - 레이스 클라이언트 라이브러리를 사용하여 하나씩 순차적으로 입력
  - 레디스 파이프라인을 사용하여 한꺼번에 입력
  - 레디스 스냅샤 파일에 직접 기록

***

## Redis 클라이언트 라이브러리를 사용한 입력

- 레디스 서버는 TCP/IP기반 클라이언트-서버 구조
- 때문에, 하나의 클라이언트에서 이전 요청이 처리되기 전에 다음 요청을 처리하지 못함
- 또한 네트워크를 통해 데이터가 왕복하는 시간도 고려해야함
  - 이를 네트워크 왕복시간(RTT, Rount Trip Time)으로 표기
- RTT때문에 대량의 데이터를 레디스 클라이언트에서 하나씩 처리하면 엄청난 시간이 필요함
- 데이터를 여러 스레드로 나누어 처리해도 성능 향상에 한계가 존재

***

## 레디스 파이프라인

- redis-cli에서 파이프라인을 사용하려면 데이터가 저장된 파일 필요
  - 순수한 레디스 명령으로 이루어진 텍스트파일이나,
  - 레디스 프로토콜로 이루어진 텍스트 파일이 필요

```redis
# 순수한 레디스 명령으로 이루어진 대량 데이터 텍스트 파일
...
set key10000122 data12314123
set key10000123 data12037892
...
```

- 위 처럼 redis-cli에서 실행 가능한 명령들을 줄바꿈을 포함한 문자열로 나열
  - 이 경우, 데이터에 텍스트가 아닌 값이 포함되면 서버로부터 프로토콜 오류 응답을 받게됨
- 프로토콜 형식의 파일을 사용하면 해결 가능

```redis
# 레디스 프로토콜로 이루어진 대량 데이터 텍스트 파일
...
*3
$3
set
$11
key10000122
$12
data12314123
$3
set
$11
key10000123
$12
data12037892
...
```

- redis-cli를 통한 파이프라인 명령으로 위 파일에 대한 대량 데이터를 추가할 수 있음

```bash
cat redis_data_command.txt | ./redis-cli --pipe
```

- 레디스 서버가 레디스 명령어를 수신하면 레디스 프로토콜 형식으로 변환 후 처리
  - 때문에 일반 명령어 집합의 데이터가 프로토콜 데이터보다 처리가 느림
- 레디스 클라이언트 라이브러리에서도 파이프라인 객체를 통해 직접 파이프라인을 사용할 수 있음

***

## 주의

- 운영 중인 시스템에 파이프라인을 사용하면 레디스의 모든 리소스를 점유함
- 때문에 서비스 중인 다른 응답 처리가 지연되기도 함